import streamlit as st
import librosa
import numpy as np
import io
import requests

st.title("ЁЯОд SYNAPSE Studio: р╕Юр╕┤р╕кр╕╣р╕Ир╕Щр╣Мр╣Бр╕гр╕Зр╣Ар╕лр╕зр╕╡р╣Ир╕вр╕Зр╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М")

# р╕гр╕▒р╕Ър╣Др╕Яр╕ер╣М 28 р╕зр╕┤ р╕Вр╕нр╕Зр╕Др╕╕р╕У
uploaded_file = st.file_uploader("ЁЯУд р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╣Ар╕кр╕╡р╕вр╕Зр╕Эр╕гр╕▒р╣Ир╕Зр╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕У", type=['wav', 'mp3'])

if uploaded_file:
    # р╕кр╕╣р╕Хр╕гр╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М: р╕Бр╕▓р╕гр╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕гр╕░р╕Фр╕▒р╕Ър╣Ар╕кр╕╡р╕вр╕З (Pitch Shifting)
    # n_steps р╕Др╕╖р╕нр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М р╕Цр╣Йр╕▓р╣Ар╕Ыр╣Зр╕Щ + р╣Ар╕кр╕╡р╕вр╕Зр╕Ир╕░р╣Бр╕лр╕ер╕б р╕Цр╣Йр╕▓р╣Ар╕Ыр╣Зр╕Щ - р╣Ар╕кр╕╡р╕вр╕Зр╕Ир╕░р╕Чр╕╕р╣Йр╕б
    shift_value = st.slider("ЁЯФв р╕Ыр╕гр╕▒р╕Ър╕Др╣Ир╕▓р╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М (Semitones)", -12, 12, 0)
    
    if st.button("ЁЯФе р╕Др╕│р╕Щр╕зр╕Ур╣Ар╕кр╕╡р╕вр╕Зр╣Гр╕лр╕бр╣И"):
        y, sr = librosa.load(uploaded_file, sr=16000)
        
        # р╕Щр╕╡р╣Ир╕Др╕╖р╕нр╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╕кр╕╣р╕Хр╕гр╕Чр╕│р╕Зр╕▓р╕Щ: р╕бр╕▒р╕Щр╕Ир╕░р╣Др╕Ыр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕Зр╕Вр╕нр╕Зр╕Др╕ер╕╖р╣Ир╕Щр╣Ар╕кр╕╡р╕вр╕З (Wavelength)
        y_shifted = librosa.effects.pitch_shift(y, sr=sr, n_steps=float(shift_value))
        
        st.audio(y_shifted, sample_rate=sr)
        st.write(f"ЁЯУК р╕кр╕╣р╕Хр╕гр╕Др╕│р╕Щр╕зр╕У: р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Др╕зр╕▓р╕бр╕Цр╕╡р╣Ир╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ър╕Фр╣Йр╕зр╕вр╕Хр╕▒р╕зр╕Др╕╣р╕У {2**(shift_value/12):.2f}")
