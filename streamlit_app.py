import streamlit as st
import google.generativeai as genai

# --- 1. ‡∏î‡∏∂‡∏á API Key ‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô (Secrets) ---
try:
    # ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠ GEMINI_API_KEY ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ô‡∏ô‡∏µ‡πâ
    GOOGLE_API_KEY = st.secrets["GEMINI_API_KEY"]
    genai.configure(api_key=GOOGLE_API_KEY)
    model = genai.GenerativeModel('gemini-pro')
except:
    st.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô! (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ GEMINI_API_KEY ‡πÉ‡∏ô Secrets)")
    st.stop()

# --- 2. ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÅ‡∏≠‡∏õ (‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡∏™‡∏∞‡πÉ‡∏à & ‡πÑ‡∏°‡πà‡πÇ‡∏•‡πà‡∏á) ---
st.markdown("""
    <style>
    .stApp { background-color: #000033; color: white; }
    .stButton>button { 
        background-color: #990000; color: white; border: 2px solid white; 
        font-weight: bold; border-radius: 10px; height: 3.5em; width: 100%;
    }
    .stTextArea>div>div>textarea { background-color: #001a00; color: white; border: 2px solid #00FF00; }
    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏≤‡∏á */
    .player-container { 
        background: linear-gradient(145deg, #000066, #000033);
        padding: 20px; border-radius: 15px; border: 3px solid #FF0000; 
        margin-bottom: 25px; text-align: center;
    }
    </style>
    """, unsafe_allow_html=True)

# --- 3. ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏≤‡∏á (SYNAPSE AUDIO PLAYER) ---
st.markdown('<div class="player-container">', unsafe_allow_html=True)
st.markdown("### üéß SYNAPSE PLAYER : ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß")
try:
    st.audio("music.mp3", loop=True)
    st.caption("üéµ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡πÅ‡∏ö‡∏ö‡∏ß‡∏ô‡∏•‡∏π‡∏õ (MP3 Mode)")
except:
    st.warning("‚ö†Ô∏è ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå music.mp3 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á")
st.markdown('</div>', unsafe_allow_html=True)

# --- 4. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á 4 ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡πÜ ---
tabs = st.tabs(["üî• ‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡πÉ‡∏à", "üé∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ô‡∏ß", "üéπ ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏á", "ü§ù ‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πå"])

with tabs[0]:
    st.markdown("### ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏õ‡∏•‡∏î‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏î‡∏≠‡∏±‡πâ‡∏ô")
    # ‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÇ‡∏•‡πà‡∏á
    c1, c2 = st.columns([5, 1])
    with c1:
        user_input = st.text_area("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á? ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î...", height=350)
    with c2:
        st.write("‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠")
        st.button("üßπ ‡∏•‡πâ‡∏≤‡∏á")
        st.button("üî• ‡πÄ‡∏ú‡∏≤")
        st.button("üíæ ‡πÄ‡∏ã‡∏ü")
    
    st.write(f"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£: {len(user_input)} | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")

with tabs[1]:
    st.markdown("### ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏ß‡∏á‡∏ó‡∏≥‡∏ô‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏¢‡∏µ‡∏¢‡∏ß‡∏¢‡∏≤‡∏´‡∏±‡∏ß‡πÉ‡∏à")
    genre = st.selectbox("‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏û‡∏•‡∏á:", ["‡∏´‡∏°‡∏≠‡∏•‡∏≥", "Pop", "Rock", "Rap", "‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á", "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï"])
    
    # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÇ‡∏•‡πà‡∏á
    col_a, col_b, col_c = st.columns(3)
    col_a.button("üîà ‡∏ü‡∏±‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á")
    col_b.button("üé≤ ‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ô‡∏ß")
    col_c.button("‚≠ê ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°")
    
    st.info("üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÅ‡∏ô‡∏ß '‡∏´‡∏°‡∏≠‡∏•‡∏≥' ‡πÅ‡∏•‡∏∞ '‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á' ‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏û‡∏•‡∏±‡∏á‡∏ö‡∏ß‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏π‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å")

with tabs[2]:
    st.markdown("### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ö‡∏ó‡πÄ‡∏û‡∏•‡∏á‡∏à‡∏≤‡∏Å AI (‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß)")
    if st.button("‚ú® ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏ö‡∏≥‡∏ö‡∏±‡∏î (AI RUN)"):
        if user_input:
            with st.spinner("AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏•‡∏á..."):
                prompt = f"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß ‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏û‡∏•‡∏á {genre} ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: {user_input} ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≠‡∏£‡πå‡∏î"
                result = model.generate_content(prompt).text
                st.code(result, language='text')
                
                # ‡∏õ‡∏∏‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 3
                btn_1, btn_2 = st.columns(2)
                btn_1.button("üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á")
                btn_2.button("üñºÔ∏è ‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û")
                
                st.markdown("---")
                st.write("üîì ‡∏ó‡∏≥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå:")
                s1, s2, s3 = st.columns(3)
                s1.button("Facebook")
                s2.button("Instagram")
                s3.button("Share Link")
        else:
            st.error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ '‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡πÉ‡∏à' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö")

with tabs[3]:
    st.markdown("### ‡∏Ñ‡∏∏‡∏¢‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏±‡∏ö '‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏¥‡πà‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö‡∏ï‡∏±‡∏ß'")
    if "chat_history" not in st.session_state: st.session_state.chat_history = []
    
    # ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ä‡∏ó
    for m in st.session_state.chat_history:
        with st.chat_message(m["role"]): st.write(m["content"])
        
    if chat_p := st.chat_input("‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."):
        st.session_state.chat_history.append({"role": "user", "content": chat_p})
        with st.chat_message("user"): st.write(chat_p)
        
        # AI ‡∏ï‡∏≠‡∏ö‡πÇ‡∏ï‡πâ
        reply = model.generate_content(f"‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: {chat_p}").text
        st.session_state.chat_history.append({"role": "assistant", "content": reply})
        with st.chat_message("assistant"): st.write(reply)
